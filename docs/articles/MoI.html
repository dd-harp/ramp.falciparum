<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MoI • ramp.falciparum</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MoI">
<meta property="og:description" content="ramp.falciparum">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ramp.falciparum</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/FoI.html">FoI</a>
    </li>
    <li>
      <a href="../articles/Dynamics.html">Infection Dynamics</a>
    </li>
    <li>
      <a href="../articles/MoI.html">MoI</a>
    </li>
    <li>
      <a href="../articles/Hybrid.html">Hybrid</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dd-harp/ramp.falciparum/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MoI</h1>
            <h3 data-toc-skip class="subtitle">Comparing Methods</h3>
            
      
      
      <div class="hidden name"><code>MoI.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/ramp.falciparum/">ramp.falciparum</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<p>In 1950, George Maccdonald published a model of malaria
superinfection (Macdonald G, 1950)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. He was trying to understand how reexposure
would affect the prevalence of infection in a population. In particular,
if people are continuously becoming reinfected, then how long would it
take until a person would clear all of the parasites to become
uninfected again? Macdonald described one model, but the mathematical
formula he used in the paper didn’t match his description. (Paul Fine’s
essay on the problematic formulation of Macdonald’s model for
superinfection is highly recommended reading (Fine PEM, 1975)<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.)</p>
<p>In 1974, Dietz presented slightly different solution to the problem
of clearance with superinfection in a mathematical model developed for
the Garki Project (Dietz K, 1974)<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>; the clearance rate was a function of the
force of infection (<span class="math inline">\(h\)</span>) and the
clearance rate (<span class="math inline">\(r\)</span>):</p>
<p><span class="math display">\[\frac{h}{e^{h/r} -1}\]</span></p>
<p>Dietz’s function was based on a <em>steady state</em> solution to a
model from queuing theory, called <span class="math inline">\(M/M/\infty\)</span>.</p>
<p>An elegant solution to the problem of superinfection was proposed by
Nåsell, who developed a hybrid modeling approach (Nåsell, 1985)<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>. The
random variables approach to the problem was formulated by Henry, <em>et
al.,</em> and this hybrid approach figures prominently in
<code>ramp.falciparum.</code></p>
<p>The following is a demonstration of software in
<code>ramp.falciparum.</code> Using the software, we show that all three
approaches give identical answers.</p>
<p>Finally, we derive a correct formula for the clearance rate under
superinfection.</p>
<div class="section level2">
<h2 id="mminfty">
<span class="math inline">\(M/M/\infty\)</span><a class="anchor" aria-label="anchor" href="#mminfty"></a>
</h2>
<p>The model Macdonald described is called <span class="math inline">\(M/M/\infty\)</span>. In this model, each new
infection increases the MoI by one; the transition rate to a higher MoI
is the force of infection (FoI), denoted <span class="math inline">\(h\)</span>. Each parasite can clear at some rate,
<span class="math inline">\(r\)</span>. The following diagram shows how
the fraction of the population with a given MoI, denoted <span class="math inline">\(\zeta_i=i\)</span>, changes over time.</p>
<hr>
<p><span class="math display">\[\begin{equation}
\begin{array}{ccccccccc}
\zeta_0 &amp;  {h\atop \longrightarrow} \atop {\longleftarrow \atop r}
&amp; \zeta_1
&amp; {h\atop \longrightarrow} \atop {\longleftarrow \atop {2r}} &amp;
\zeta_2
&amp; {h \atop \longrightarrow} \atop {\longleftarrow \atop {3r}} &amp;
\zeta_3
&amp; {h \atop \longrightarrow} \atop {\longleftarrow \atop {4r}}&amp;
\ldots
\end{array}
\end{equation}\]</span></p>
<hr>
<p>Changes in the fraction uninfected (MoI=0) are described by:</p>
<p><span class="math display">\[\frac{d \zeta_0}{dt} = r \zeta _1 - h
\zeta_0.\]</span></p>
<p>For those who are infected (with MoI<span class="math inline">\(=i\)</span>), the dynamics are:</p>
<p><span class="math display">\[\frac{d \zeta_i}{dt} = h \zeta_{i-1} +
r(i+1) \zeta_{i+1} - (r+h) \zeta_i\]</span> The software in
<code>ramp.falciparum</code> includes functions to set up and solve the
queuing model <span class="math inline">\(M/M/\infty.\)</span></p>
<p>While <span class="math inline">\(M/M/\infty\)</span> is an infinite
system of differential equations, the function
<code>solveMMinfinity</code> solves a finite system of differential
equations. The maximum MoI is chosen to be large enough that it doesn’t
affect the results.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MMinf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solveMMinfty.html">solveMMinfty</a></span><span class="op">(</span><span class="fl">5</span><span class="op">/</span><span class="fl">365</span>, <span class="va">foiP3</span>, Amax<span class="op">=</span><span class="fl">1095</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">MMinf</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">m</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">tau</span><span class="op">]</span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"a - cohort age (in days)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="MoI_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="the-hybrid-model">The Hybrid Model<a class="anchor" aria-label="anchor" href="#the-hybrid-model"></a>
</h2>
<p>While the infinite system of differential equations can be formulated
and solved numerically, Nåsell showed that the system can be described
by a simple equation. Let <span class="math inline">\(m\)</span> denote
the mean MoI.</p>
<p><span class="math display">\[
\frac{dm}{dt} = h-rm
\]</span></p>
<p>He also showed that the distribution of the MoI would converge to a
Poisson distribution. If the initial distribution was Poisson, then it
would remain Poisson forever.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hybrid</span> <span class="op">=</span> <span class="fu"><a href="../reference/solve_dm.html">solve_dm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">/</span><span class="fl">365</span>, <span class="va">foiP3</span>, Amax<span class="op">=</span><span class="fl">1095</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">hybrid</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">m</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">tau</span><span class="op">]</span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"a - cohort age (in days)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="MoI_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="the-random-variables-approach">The Random Variables Approach<a class="anchor" aria-label="anchor" href="#the-random-variables-approach"></a>
</h2>
<p>Let <span class="math inline">\(z(\alpha, a)\)</span> denote the
density of parasite cohorts of age <span class="math inline">\(\alpha\)</span> in a host cohort of age <span class="math inline">\(a\)</span>. We assume infections clear at the
constant rate <span class="math inline">\(r\)</span>. Since infections
in <span class="math inline">\(M/M/\infty\)</span> are independent, we
can track the dynamics for the AoI of all parasite cohorts with the
equation,</p>
<p><span class="math display">\[\begin{equation}
\frac{\partial z}{\partial a} + \frac{\partial z}{\partial \alpha} = -
rz,
\end{equation}\]</span></p>
<p>with the boundary condition <span class="math inline">\(z_\tau(a,0)=h_\tau(a).\)</span> We note that the
age of the host birth cohort sets an upper limit for the parasite
cohort, so <span class="math inline">\(0 &lt; \alpha &lt; a\)</span>.
The solution, which describes density of infections of age <span class="math inline">\(\alpha\)</span> in a host cohort of age <span class="math inline">\(a\)</span>, is given by the formula:</p>
<p><span class="math display">\[\begin{equation}
z_\tau(\alpha, a | h) = h_\tau \left(a-\alpha\right) e^{-r \alpha}.
\label{zda}
\end{equation}\]</span></p>
<p>From these equations, we derive random variables describing the MoI,
the AoI, and the AoY, noting that the mean MoI is:</p>
<p><span class="math display">\[\begin{equation}
m_\tau(a | h) = \int_0^a z_\tau(\alpha, a |h) d \alpha
\end{equation}\]</span></p>
<p>In <code>ramp.falciparum,</code> this is computed with the function
<code>meanMoI</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moi</span> <span class="op">=</span> <span class="fu"><a href="../reference/meanMoI.html">meanMoI</a></span><span class="op">(</span><span class="va">aa</span>, <span class="va">foiP3</span>, hhat<span class="op">=</span><span class="fl">5</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aa</span>, <span class="va">moi</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="va">tau</span><span class="op">]</span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"a - cohort age (in days)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="MoI_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>The three give the same answers, up to slight differences introduced
by the numerical methods:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">moi</span> <span class="op">-</span> <span class="va">hybrid</span><span class="op">$</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-9</span>,</span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">MMinf</span><span class="op">$</span><span class="va">m</span><span class="op">-</span> <span class="va">hybrid</span><span class="op">$</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-10</span>,</span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">moi</span> <span class="op">-</span> <span class="va">hybrid</span><span class="op">$</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-8</span>,</span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">MMinf</span><span class="op">$</span><span class="va">m</span><span class="op">-</span> <span class="va">hybrid</span><span class="op">$</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">&lt;</span> <span class="fl">1e-10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE TRUE TRUE TRUE</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="prevalence">Prevalence<a class="anchor" aria-label="anchor" href="#prevalence"></a>
</h2>
<p>With all this information at hand, we are now in a position to
formulate a model for superinfection.</p>
<p>We note that since <span class="math inline">\(m\)</span> is the mean
of a Poisson, the prevalence of infection can be computed directly from
<span class="math inline">\(m\)</span>. It is the complement of the zero
term from a Poisson:</p>
<p><span class="math display">\[p(t) = 1-\mbox{Pois}(\zeta =0; m(t)) = 1
- e^{-m(t)}\]</span></p>
<p>It is, nevertheless, sometimes useful to know the clearance rate, a
transition from MoI = 1 to MoI=0. Clearance from the infected class can
only occur if a person is infected with an MoI of one, and if that
infection clears:</p>
<p><span class="math display">\[
R(m) = r \frac{\mbox{Pr}(\zeta=1; m(t))}{\mbox{Pr}(\zeta&gt;0; m(t))} =
r \frac{m e^{-m}}{1-e^{-m}}  = r \frac{m}{e^{-m}-1}
\]</span></p>
<p>The change in prevalence is thus described by the equation:</p>
<p><span class="math display">\[
\frac{dp}{dt} = h(1-p)-R(m)p
\]</span></p>
<p>While this is interesting, and while it solves the problem of
modeling clearance under superinfection, the equation depends on <span class="math inline">\(m\)</span>. Since we can compute <span class="math inline">\(p(t)\)</span> directly from <span class="math inline">\(m(t)\)</span>, the equation for prevalence is
completely redundant.</p>
<p>On the other hand, if we wanted a model for prevalence that did not
use <span class="math inline">\(m\)</span>, we could rewrite the
equation:</p>
<p><span class="math display">\[
\frac{dp}{dt} = h(1-p) + r \ln (1-p) \frac{(1-p) }{p}
\]</span></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p> Macdonald G. The analysis of infection rates in
diseases in which superinfection occurs. Trop Dis Bull. 1950;47:
907–915<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Fine PEM. Superinfection - a problem in formulating a
problem. Tropical Diseases Bulletin. 1975;75: 475–488<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Dietz K, Molineaux L, Thomas A. A malaria model tested
in the African savannah. Bull World Health Organ. 1974;50: 347–357<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Nåsell I. Hybrid Models of Tropical Infections. 1st
edition. Berlin: Springer-Verlag; 1985. <a href="https://doi.org/10.1007/978-3-662-01609-1" class="external-link uri">https://doi.org/10.1007/978-3-662-01609-1</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by John M. Henry, David L. Smith.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
